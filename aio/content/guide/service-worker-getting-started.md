{@a getting-started-with-service-workers}
# Начало работы с работниками сферы обслуживания


В этом документе объясняется, как включить поддержку Angular Service Worker в проектах, которые вы создали с помощью [Angular CLI](cli). Затем он использует простой пример, чтобы показать вам работника службы в действии, демонстрируя загрузку и базовое кэширование.

{@a prerequisites}
#### Предпосылки

Базовое понимание информации в [Введение в работников сферы услуг Angular](guide/service-worker-intro).


{@a adding-a-service-worker-to-your-project}
## Добавление сервисного работника в ваш проект

Чтобы настроить работника службы Angular в своем проекте, используйте команду CLI `ng add @angular/pwa` . Он заботится о настройке вашего приложения для использования сервисными работниками, добавив `service-worker` пакет вместе
с настройкой необходимых файлов поддержки.

```sh
ng add @angular/pwa --project *project-name*
```

Эта команда выполняет следующие действия:

1. Добавляет `@angular/service-worker` пакет для вашего проекта.
2. Включает поддержку сборки сервисного работника в CLI.
3. Импортирует и регистрирует работника сервиса в модуле приложения.
4. Обновляет `index.html` файл:
    * Включает ссылку для добавления `manifest.json` файл.
    * Добавляет метатеги для `theme-color`.
5. Устанавливает файлы значков для поддержки установленного Progressive Web App (PWA).
6. Создает файл конфигурации работника сервиса с именем [ `ngsw-config.json` ](/guide/service-worker-config), в котором указываются параметры кэширования и другие параметры.


Теперь, построить проект:

```sh
ng build --prod
```

Проект CLI теперь настроен на использование сервисного работника Angular.


{@a service-worker-in-action-a-tour}
## Работник службы в действии: экскурсия

Этот раздел демонстрирует работника службы в действии
используя пример приложения.

{@a serving-with-http-server}
### Служа с `http-server` 

Потому что `ng serve` не работает с сервисными работниками, вы должны использовать отдельный HTTP-сервер для локального тестирования вашего проекта. Вы можете использовать любой HTTP-сервер. В приведенном ниже примере используется [http-server](https://www.npmjs.com/package/http-server)пакет из npm. Чтобы уменьшить вероятность конфликтов и избежать обслуживания устаревшего контента, протестируйте выделенный порт и отключите кэширование.

Служить каталогу, содержащему ваши веб-файлы с `http-server`, выполните следующую команду:

```sh
http-server -p 8080 -c-1 dist/<project-name>
```

{@a initial-load}
### Начальная загрузка

Когда сервер работает, вы можете указать свой браузер по адресу http: // localhost: 8080 /. Ваше приложение должно загружаться нормально.

**Совет:** при тестировании сервисных работников Angular рекомендуется использовать в браузере инкогнито или закрытое окно, чтобы убедиться, что сервисный работник не заканчивает чтение из предыдущего оставшегося состояния, что может вызвать неожиданное поведение.

<div class="alert is-helpful">

**Примечание:**
Если вы не используете HTTPS, сервисный работник будет зарегистрирован только при доступе к приложению на `localhost`.

</div>

{@a simulating-a-network-issue}
### Имитация проблемы сети

Чтобы смоделировать проблему с сетью, отключите сетевое взаимодействие для своего приложения. В Chrome:

1. Выберите « **Инструменты» Инструменты** > «**разработчика»** (в меню Chrome, расположенном в верхнем правом углу).
2. Перейдите на **вкладку Сеть**.
3. Установите **флажок Оффлайн**.

<div class="lightbox">
  <img src="generated/images/guide/service-worker/offline-checkbox.png" alt="The offline checkbox in the Network tab is checked">
</div>

Теперь приложение не имеет доступа к сетевому взаимодействию.

Для приложений, которые не используют сервис Angular, при обновлении теперь отображается отключенная от Интернета страница Chrome с надписью «Нет подключения к Интернету».

С добавлением работника службы Angular поведение приложения меняется. При обновлении страница загружается нормально.

Если вы посмотрите на вкладку Сеть, вы можете убедиться, что работник службы активен.

<div class="lightbox">
  <img src="generated/images/guide/service-worker/sw-active.png" alt="Requests are marked as from ServiceWorker">
</div>

Обратите внимание, что в столбце «Размер» состояние запросов `(from ServiceWorker)` . Это означает, что ресурсы не загружаются из сети. Вместо этого они загружаются из кэша работника сервиса.


{@a whats-being-cached}
### Что кешируется?

Обратите внимание, что все файлы, необходимые браузеру для визуализации этого приложения, кэшируются. `ngsw-config.json` конфигурация газетного устанавливается кэшировать определенные ресурсы, используемые CLI:

* `index.html`.
* `favicon.ico`.
* Построить артефакты (JS и CSS).
* Что-нибудь под `assets`.
* Изображения и шрифты прямо под настроенным `outputPath` (по умолчанию `./dist/<project-name>/`) или `resourcesOutputPath` . Смотрите [ `ng build` ](cli/build)для получения дополнительной информации об этих параметрах.


<div class="alert is-helpful">
Обратите внимание на два ключевых момента:

1. Сгенерированный `ngsw-config.json` содержит ограниченный список кэшируемых шрифтов и расширений изображений. В некоторых случаях вы можете изменить шаблон глобуса в соответствии с вашими потребностями.

1. Если `resourcesOutputPath` или `assets` пути изменяются после создания файла конфигурации, вам необходимо изменить пути вручную в `ngsw-config.json`.
</div>

{@a making-changes-to-your-application}
### Внесение изменений в ваше приложение

Теперь, когда вы видели, как работники службы кэширования приложения, то
Следующим шагом является понимание того, как работают обновления.

1. Если вы тестируете в окне инкогнито, откройте вторую пустую вкладку. Это сохранит инкогнито и состояние кэша во время теста.

2. Закройте вкладку приложения, но не окно. Это также должно закрыть Инструменты разработчика.

3. Отключить `http-server`.

4. Затем внесите изменения в приложение и посмотрите, как работник службы установки устанавливает обновление.

5. Открыть `src/app/app.component.html` для редактирования.

6. Изменить текст `Welcome to {{title}}! ` в ` Bienvenue à {{title}}!`,

7. Построить и запустить сервер снова:

```sh
ng build --prod
http-server -p 8080 -c-1 dist/<project-name>
```

{@a updating-your-application-in-the-browser}
### Обновление вашего приложения в браузере

Теперь посмотрим, как браузер и сервисный работник обрабатывают обновленное приложение.

1. Снова откройте http: // localhost: 8080 в том же окне. Что происходит?

<div class="lightbox">
  <img src="generated/images/guide/service-worker/welcome-msg-en.png" alt="It still says Welcome to Service Workers!">
</div>

Что пошло не так? На самом деле ничего. Сервисный работник Angular выполняет свою работу и обслуживает версию приложения, которое он **установил**, несмотря на наличие доступных обновлений. В интересах скорости, обслуживающий работник не ждет проверки обновлений, прежде чем он обслуживает приложение, которое он кэшировал.

Если вы посмотрите на `http-server` Журналы, вы можете увидеть запрос работника службы `/ngsw.json` . Вот как работник службы проверяет наличие обновлений.

2. Обновите страницу.

<div class="lightbox">
  <img src="generated/images/guide/service-worker/welcome-msg-fr.png" alt="The text has changed to say Bienvenue à app!">
</div>

Работник сервиса установил обновленную версию вашего приложения *в фоновом режиме*, и при следующей загрузке или перезагрузке страницы работник сервиса переключится на последнюю версию.

<hr />

{@a more-on-angular-service-workers}
## Больше на Angular сервисных рабочих

Вы также можете быть заинтересованы в следующих ситуациях :
* [Общение с работниками сферы обслуживания](guide/service-worker-communications).
