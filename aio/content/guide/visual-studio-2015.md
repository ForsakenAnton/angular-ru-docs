{@a using-angular-with-visual-studio-2015}
# Использование Angular с Visual Studio 2015

{@a top}

Некоторые разработчики предпочитают Visual Studio в качестве интегрированной среды разработки (IDE).

В этой поваренной книге описываются шаги, необходимые для настройки и использования файлов приложений Angular в Visual Studio 2015 в рамках проекта ASP.NET 4.x.

<div class="alert is-helpful">



Там нет *живой пример* для этой кулинарной книги, потому что она описывает Visual Studio, а не
Само Angular приложение. В используется стартовое приложение Angular, созданное командой CLI [ `ng new` ](cli/new)качестве примера.


</div>


{@a asp-net-4}

{@a asp.net-4.x-project}
## ASP.NET 4.x проекта

Для настройки файлов «Начало работы» с **проектом ASP.NET 4.x** в
Visual Studio 2015, выполните следующие действия

<div class="alert is-helpful">



Если вы предпочитаете `File | New Project` опыт и используют **ASP.NET Сердечник**,
затем рассмотрите _experimental_
<a href="http://blog.stevensanderson.com/2016/10/04/angular2-template-for-visual-studio/">ASP.NET Core + Angular шаблон для Visual Studio 2015 </a>.
Обратите внимание, что полученный код не отображается на документы. Отрегулируйте соответственно.


</div>




<h2 id='prereq1'>
  Необходимое условие: Node.js
</h2>



Установите **[Node.js® и npm](https://nodejs.org/en/download/)**
если они еще не на вашей машине.
Смотрите [Настройка локальной среды](guide/setup-local "Setting up for Local Development") для поддерживаемых версий и инструкций.






<h2 id='prereq2'>
  Необходимое условие: Visual Studio 2015, обновление 3
</h2>



Минимальное требование для разработки приложений Angular с помощью Visual Studio - это обновление 3
Более ранние версии не соответствуют рекомендациям по разработке приложений с использованием TypeScript.
Чтобы просмотреть свою версию Visual Studio 2015, перейдите на `Help | About Visual Studio`.

Если у вас его нет, установите **[Visual Studio 2015 Update 3](https://www.visualstudio.com/en-us/news/releasenotes/vs2015-update3-vs)**.
Или использовать `Tools | Extensions and Updates` для обновления до Обновления 3 непосредственно из Visual Studio 2015



<h2 id='prereq3'>
  Предварительное условие: настроить внешние веб-инструменты
</h2>



Настройка Visual Studio для использования глобальных внешних веб - инструментов вместо инструментов, которые поставляются с Visual Studio:

  * Откройте**Параметры** диалога с  `Tools`  |  `Options`.
  * В дереве слева выберите `Projects and Solutions ` | ` External Web Tools`.
  * Справа переместите  `$(PATH)`  над полем  `$(DevEnvDir`) записей. Это говорит Visual Studio
    используйте внешние инструменты (такие как npm), найденные в глобальном пути, прежде чем использовать собственную версию внешних инструментов.
  * Нажмите кнопку ОК, чтобы закрыть диалоговое окно.
  * Перезапустите Visual Studio, чтобы изменения вступили в силу.

Visual Studio теперь сначала ищет внешние инструменты в текущей рабочей области и
если он не находит их, он смотрит в глобальный путь. Если Visual Studio нет
найти их в любом месте, он будет использовать свои собственные версии инструментов.



<h2 id='prereq4'>
  Условие: установить TypeScript для Visual Studio 2015
</h2>



Хотя Visual Studio Update 3 поставляется с поддержкой TypeScript из коробки, в настоящее время он не поставляется с более новыми версиями TypeScript, которые необходимы для разработки приложений на Angular.

Чтобы установить последнюю версию Машинопись:

 * Загрузите и установите последнюю версию [машинопись для Visual Studio 2015](https://www.microsoft.com/en-us/download/details.aspx?id=48593),

 * ИЛИ установите его с помощью npm: `npm install -g typescript@latest`.

Вы можете узнать больше о поддержке TypeScript в Visual Studio **[здесь](https://blogs.msdn.microsoft.com/typescript/announcing-typescript-3-1/)**.

На данный момент Visual Studio готова. Это хорошая идея, чтобы закрыть Visual Studio и
перезапустите его, чтобы убедиться, что все чисто.



<h2 id='download'>
  Шаг 1. Создайте стартовое приложение Angular
</h2>


Следуйте инструкциям в разделе [Настройка локальной среды](guide/setup-local "Setting up for Local Development") чтобы создать начальное приложение Angular с помощью команды CLI [ `ng new` ](cli/new).





<h2 id='create-project'>
  Шаг 2. Создайте проект Visual Studio ASP.NET
</h2>



Создание 4.x проекта ASP.NET обычным способом следующим образом :

* В Visual Studio выберите  `File`  |  `New`  |  `Project`  из меню.
* В дереве шаблонов выберите  `Templates`  | `Visual C# ` (или ` Visual Basic`) |  `Web`.
* Выберите `ASP.NET Web Application` Шаблон, присвойте проекту имя и нажмите «ОК».
* Выберите нужный шаблон ASP.NET 4.5.2 и нажмите ОК.


<div class="alert is-helpful">



Эта кулинарная книга использует  `Empty`  шаблон без добавленных папок
без аутентификации и без хостинга. Выберите шаблон и параметры, подходящие для вашего проекта.


</div>




<h2 id='copy'>
  Шаг 3: Скопируйте файлы проекта Angular в папку проекта ASP.NET
</h2>

Скопируйте файлы из начального приложения Angular в папку, содержащую  `.csproj`  Файл.
Включите файлы в визуальном проекте студии следующим образом :

* Нажмите на `Show All Files` Кнопка в обозревателе решений, чтобы отобразить все скрытые файлы в проекте.
* Щелкните правой кнопкой мыши по каждой папке / файлу, который будет включен в проект, и выберите `Include in Project`.
  Минимально, включают в себя следующие папки / файлы:

  * папка src / app (ответьте «*Нет», *  если вас попросят найти TypeScript Typings)
  * src / styles.css
  * src / index.html
  * package.json
  * src / tsconfig.json



<h2 id='restore'>
  Шаг 4: Восстановите необходимые пакеты
</h2>



Восстановить пакеты, необходимые для Angular приложения следующим образом :

* Щелкните правой кнопкой мыши на  `package.json`  файл в обозревателе решений и выберите `Restore Packages`.
  <br>`npm` будет использован чтобы установить все пакеты, определенные в  `package.json`  файл.
  Это может занять некоторое время.
* При желании откройте окно вывода (`View`  |  `Output`) для просмотра выполнения команд npm.
* Не обращайте внимания на предупреждения.
* Когда восстановление завершится, появится сообщение в нижней панели сообщений Visual Studio
  должен сказать: `Installing packages complete` . Потерпи. Это может занять некоторое время.
* Нажмите на  `Refresh`  значок в обозревателе решений.
* **Не** включайте  `node_modules`  папка в проекте. Пусть это будет скрытая папка проекта.



<h2 id='build-and-run'>
  Шаг 5: Создайте и запустите приложение
</h2>



Во-первых, убедитесь, что  `src/index.html`  устанавливается в качестве стартовой страницы.
Щелкните правой кнопкой мыши  `index.html`  в обозревателе решений и выберите опцию `Set As Start Page`.

{@a to-run-in-vs-with-f5}
### Для запуска в VS с F5

Большинству разработчиков Visual Studio нравится нажимать клавишу F5 и видеть, как работает сервер IIS.
Чтобы использовать сервер IIS с приложением «Начало работы», необходимо внести следующие три изменения.

1. В  `index.html`, измените базовый href с `<base href="/"> ` на ` <base href="/src/">`.
2. Также в  `index.html`, измените сценарии для использования  `/node_modules`  с косой чертой
вместо того  `node_modules`  без косой черты.
3. В  `src/systemjs.config.js`, в верхней части файла,
изменить нпм  `path`  к  `/node_modules/`  с косой чертой.


<div class="alert is-important">



После этих изменений `npm start` больше не работает.
Вы должны настроить _either_ для F5 с IIS _or_ для   `npm start` с lite-сервера.


</div>



{@a for-apps-that-use-routing}
### Для приложений, которые используют маршрутизацию

Если ваше приложение использует маршрутизацию, вам нужно научить сервер всегда возвращаться
 `index.html` когда пользователь запрашивает страницу HTML
по причинам, указанным в руководстве [развертывание](guide/deployment#fallback).

Все выглядит нормально, пока вы перемещаетесь по приложению.
Но вы сразу увидите проблему, если обновите браузер
или вставьте ссылку на страницу приложения (называемую «глубокой ссылкой») в адресную строку браузера.

Скорее всего, вы получите *404 - Страница не найдена* ответ с сервера
для любого адреса, кроме  `/`   или же  `/index.html`.

Вы должны настроить сервер для возврата  `index.html`  для запросов к этим «неизвестным» страницам.
 `lite-server` разработки делает из коробки.
Если вы переключились на F5 и IIS, вы должны настроить IIS для этого.
В этом разделе рассматриваются шаги по адаптации приложения Getting Started.

{@a configure-iis-rewrite-rules}
#### Настройте правила перезаписи IIS

Visual Studio поставляется с IIS Express, в который встроен модуль перезаписи
Однако, если вы используете обычный IIS, вам придется установить переписать
модуль.

Скажите Visual Studio, как обрабатывать запросы на страницы приложения маршрута, добавляя их
переписать правила в нижней части  `web.config`  :


<code-example format='.'>
  &lt;system.webServer&gt;
    &lt;rewrite&gt;
      &lt;rules&gt;
        &lt;rule name="Angular Routes" stopProcessing="true"&gt;
          &lt;match url=".*" /&gt;
          &lt;conditions logicalGrouping="MatchAll"&gt;
            &lt;add input="{REQUEST_FILENAME}" matchType="IsFile" negate="true" /&gt;
            &lt;add input="{REQUEST_FILENAME}" matchType="IsDirectory" negate="true" /&gt;
          &lt;/conditions&gt;
          &lt;action type="Rewrite" url="/src/" /&gt;
        &lt;/rule&gt;
      &lt;/rules&gt;
    &lt;/rewrite&gt;
  &lt;/system.webServer&gt;

</code-example>



<div class="alert is-helpful">



URL совпадения, `<match url=".*" />`, будет переписывать каждый запрос. Вам придется настроить это, если
Вы хотите, чтобы некоторые запросы проходили, например запросы веб-API.

URL в `<action type="Rewrite" url="/src/"/>` должен
сопоставить базовую ссылку в  `index.html`.


</div>



Создайте и запустите приложение с помощью отладчика, нажав кнопку « **Выполнить»** или нажав  `F5`.


<div class="alert is-helpful">



Быстрее запустить без отладчика нажатием  `Ctrl-F5`.

</div>



Откроется браузер по умолчанию и отобразится пример приложения Getting Started.

Попробуйте отредактировать любой из файлов проекта. Сохраните и обновите браузер до
увидеть изменения.
