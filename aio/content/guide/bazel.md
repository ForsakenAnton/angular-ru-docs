{@a building-with-bazel}
# Cборка с Bazel

В этом руководстве объясняется, как создавать и тестировать приложения Angular с помощью Bazel.


<div class="alert is-helpful">

В этом руководстве предполагается, что вы уже знакомы с разработкой и сборкой приложений Angular с использованием [CLI](cli).

Он описывает функции, которые являются частью Angular Labs и не считаются стабильным, поддерживаемым API.

</div>

{@a using-bazel-with-the-angular-cli}
## Использование Bazel с Angular CLI

 `@angular/bazel` Пакет предоставляет компоновщик, который позволяет Angular CLI использовать Bazel в качестве инструмента компоновки.

Чтобы включить существующее приложение, запустите

```sh
ng add @angular/bazel
```

Чтобы использовать Bazel в новом приложении, сначала установите `@angular/bazel` глобально

```sh
npm install -g @angular/bazel
```

затем создайте новое приложение с помощью

```sh
ng new --collection=@angular/bazel
```

Теперь, когда вы используете команды сборки Angular CLI, такие как `ng build ` и ` ng serve`,
Базель используется за кулисами.
Выходы из Базеля появляются в `dist/bin` папка.

> Вывод командной строки включает в себя дополнительные записи из Bazel.
> Мы планируем уменьшить это в будущем.

{@a removing-bazel}
### Удаление Базеля

Если вам нужно, чтобы отказаться от использования Bazel, вы можете восстановить резервные копии файлов:

- `/angular.json.bak ` заменяет ` /angular.json` 

{@a advanced-configuration}
## Расширенная конфигурация

<div class="alert is-helpful">

Редактирование конфигурации Bazel может помешать вам отказаться от Bazel.
Пользовательское поведение, управляемое Базелем, не будет доступно в других Строителях.

В этом разделе предполагается, что вы знакомы с [Bazel](https://docs.bazel.build).

</div>

Вы можете вручную настроить конфигурацию Базэл на:

* настроить шаги сборки
* распараллелить сборку для масштаба и приращения

Создание исходных файлов конфигурации Bazel, выполнив следующую команду:

```sh
ng build --leaveBazelFilesOnDisk
```

Теперь вы найдете новые файлы в угловом рабочем пространстве

* `/WORKSPACE` сообщает как загружать внешние зависимости.
* `/BUILD.bazel ` и ` /src/BUILD.bazel` расскажите о вашем исходном коде.

Вы можете найти полнофункциональный пример с пользовательскими настройками Bazel по адресу https://github.com/bazelbuild/rules_nodejs/tree/master/examples/angular.

Документация по использованию Bazel для внешних проектов приведена по ссылке https://docs.bazel.build/versions/master/bazel-and-javascript.html.



{@a running-bazel-directly}
## Запускаю Базель напрямую

В некоторых случаях вы захотите обойти сборщик Angular CLI и напрямую запустить Bazel CLI.
Инструмент Bazel управляется `@bazel/bazelisk` Пакет (аналогично тому, как Node.js может управляться `nvm`).
Вы можете установить его глобально, чтобы получить `bazelisk` команда на вашем пути, или используйте `$(npm bin)/bazelisk` вместо базелиска ниже.

Общие команды в Базэла являются:

* `bazelisk build [targets]` : выходные артефакты по умолчанию для указанных целей.
* `bazelisk test [targets]` : для любого `*_test` цели находятся в шаблонах, запустите тесты.
* `bazelisk run [target]` : программу, представленную target, и затем запустите ее.

Чтобы повторить команду при каждом изменении входов (режим просмотра), замените `bazelisk` с `ibazel` в этих командах.

Места вывода печатаются на выходе.

Полная документация по интерфейсу командной строки Bazel находится по адресу https://docs.bazel.build/versions/master/command-line-reference.html.


{@a querying-the-build-graph}
## Запрос графика сборки

Поскольку Базель строит график из ваших целей, вы можете найти много полезной информации.

Используя необязательную зависимость graphviz, вы получите программу `dot`, которую вы можете использовать с `bazel query` :

```bash
$ bazel query --output=graph... | dot -Tpng > graph.png
```

См. Https://docs.bazel.build/versions/master/query-how-to.html для получения дополнительной информации о `bazel query`.


{@a customizing-build.bazel-files}
## Пользовательская настройка `BUILD.bazel` Файлы

«Правила» похожи на плагины для Bazel. Многие наборы правил доступны. В этом руководстве описаны документы, поддерживаемые командой Angular в Google.

Правила используются в `BUILD.bazel` Файлы, которые являются маркерами для пакетов в вашей рабочей области. каждый `BUILD.bazel` Файл объявляет отдельный пакет для Bazel, хотя вы можете иметь более грубые дистрибутивы, чтобы пакеты, которые вы публикуете (например, для `npm`) может состоять из множества пакетов Bazel.

в `BUILD.bazel` Файл, каждое правило должно быть сначала импортировано, используя `load` заявление. Затем правило вызывается с некоторыми атрибутами, и результат вызова правила заключается в том, что вы объявили Bazel, как оно может выводить некоторые выходные данные с учетом некоторых входных данных и зависимостей. Потом, когда вы запускаете `bazel` командной строке загружает все объявленные вами правила, чтобы определить абсолютный порядок действий, которые необходимо выполнить. Обратите внимание, что на самом деле будут выполняться только те правила, которые необходимы для получения запрошенного вывода.

Список общих правил разработки веб-интерфейса описан в README по адресу https://github.com/bazelbuild/rules_nodejs/.
