{@a $localize-global-import-migration}
#  `$localize` Global Import Migration

{@a what-does-this-schematic-do}
## Что делает эта схема?

Если вы используете i18n, эта схема добавляет оператор импорта для  `@angular/localize`  to  `polyfills.ts`  которая будет выглядеть примерно так:

```ts
/******************************************************************
 * Load  `$localize`  - used if i18n tags appear in Angular templates.
 */
import '@angular/localize/init';
```

Это также списки  `@angular/localize`  как зависимость в вашем приложении  `package.json`  чтобы гарантировать, что импорт найден.

```json

"dependencies": {
  ...
  "@angular/localize": "...",
  ...
}

```

 `@angular/localize` - это новый пакет, который поддерживает i18n сообщений в приложениях Ivy.
Этот пакет требует глобального  `$localize`  символ для существования.
Символ загружается путем импорта  `@angular/localize/init`  Модуль, побочным эффектом которого является его привязка к глобальной области видимости.

{@a why-is-this-migration-necessary}
## Почему эта миграция необходима?

До версии Angular 9 система интернационализации Angular (i18n) встраивала переведенные сообщения в скомпилированный вывод как часть этой компиляции шаблона.
Этот подход требовал запуска компилятора шаблона один раз для целевого языкового стандарта, что часто приводило к замедлению времени сборки продукта.

В новой системе i18n Angular-компилятор помечает сообщения i18n в скомпилированном коде глобальным  `$localize`  обработчик.
Встраивание переводов затем происходит как шаг после компиляции для каждой локали.
Поскольку приложение не нужно создавать заново для каждой локали, это значительно ускоряет процесс.

Шаг встраивания после компиляции является необязательным - например, во время разработки или если переводы будут встроены во время выполнения.
Поэтому этот глобальный  `$localize`  должен быть доступен в глобальной области видимости во время выполнения.
Делать  `$localize`  доступен в глобальной области видимости, теперь каждое приложение должно импортировать  `@angular/localize/init`  модуль.
Это имеет побочный эффект прикрепления минимальной реализации  `$localize`  для глобальной области видимости.

Если импорт отсутствует, вы увидите сообщение об ошибке, как это:

```
Error: It looks like your application or one of its dependencies is using i18n.
Angular 9 introduced a global  `$localize()`  function that needs to be loaded.
Please run  `ng add @angular/localize`  from the Angular CLI.
(For non-CLI projects, add  `import '@angular/localize/init';`  to your polyfills.ts file)
```

Эта схема автоматически добавляет  `@angular/localize/init`  импорт для вас
если ваше приложение использует API Angular i18n.


{@a why-is-my-tslint-failing}
## Почему мой tslint терпит неудачу?

Импорт  `@angular/localize/init`  может вызвать ошибку tslint для  `no-import-side-effect`  потому что он добавляет к глобальному контексту (то есть побочный эффект).
Чтобы исправить эту ошибку, добавьте следующее к вашему  `tslint.config`  :

```json

"no-import-side-effect": [
  true,
  {
    "ignore-module": "(core-js/.*|zone\\.js/.*|@angular/localize/init)$"
  }
]

```


{@a do-i-need-to-change-how-i-write-i18n-in-my-angular-templates}
## Нужно ли мне изменить способ написания i18n в моих шаблонах Angular?

Синтаксис шаблона для i18n не изменился, поэтому вы все равно захотите использовать  `i18n`  атрибут как вы делали раньше.
